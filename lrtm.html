<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Rail Ticket Machine</title>
    <style>
      .plate {
        height: min-content;
        width: min-content;
        background-color: #D1CDC9;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12.5px;
        padding: 25px 20px;
        border: 1px solid #545250;
        border-radius: 5px;
      }
      .btn {
        height: 50px;
        width: 50px;
        background-color: #B5B4B3;
        color: #292217;
        border: 1px solid #545250;
        border-radius: 5px;
        font-size: 35px;
        line-height: 50px;
        text-align: center;
        font-family: Helvetica, Arial;
      }
    </style>
  </head>
  <body>
    <div class="plate">
      <div class="btn" onclick="click_btn('1');">1</div>
      <div class="btn" onclick="click_btn('2');">2</div>
      <div class="btn" onclick="click_btn('3');">3</div>
      <div class="btn" onclick="click_btn('4');">4</div>
      <div class="btn" onclick="click_btn('5');">5</div>
      <div class="btn" onclick="click_btn('6');">6</div>
      <div class="btn" onclick="click_btn('7');">7</div>
      <div class="btn" onclick="click_btn('8');">8</div>
      <div class="btn" onclick="click_btn('9');">9</div>
      <div class="btn" onclick="click_btn('*');" style="font-size: 45px; line-height: 65px;">*</div>
      <div class="btn" onclick="click_btn('0');">0</div>
      <div class="btn" onclick="click_btn('#');" style="font-size: 25px;">#</div>
    </div>
    <script>
      let audio_mode;
      let lang = "0";
      let userinputs;
      let audio;
      let ticketdest;
      async function click_btn(x) {
        if (audio_mode !== 1) {
          if (x === "5") {
            userinputs = "";
            ticketdest = "";
            lang = "0";
            audio_mode = 1;
            play_audio("01");
          }
          return;
        }
        if (x === "*") {
          console.log("02 Transaction Cancelled");
          audio_mode = 0;
          return;
        }
        userinputs += x;
        switch (userinputs.length) {
          case 1:
            if ((x === "1" || x === "2" || x === "3") && lang === "0") {
              lang = x;
              console.log("04 You are in");
              console.log("05-10 Zone");
              console.log("44 Stop");
              console.log("11 This machine - buy ticket only");
              play_audio("12");
              console.log("13 To cancel transaction at any time, press *");
              console.log("14 Please select service: Buy single journey ticket, press 1");
            }
            break;
          case 2:
            if (x === "1") {
              console.log("15 To buy tickets by selecting destination zone, press 1. To buy ticket by selecting destination stop, press 2.");
            }
            break;
          case 3:
            if (x === "1") {
              console.log("16 Zone");
            } else if (x === "2") {
              console.log("17 Stop");
            }
            break;
          case 4:
            if (x !== "#") {
              userinputs = userinputs.slice(0, -1);
              ticketdest += x;
            } else {
              console.log("18 Please select ticket type");
            }
            break;
          case 5:
            await play_audio("19");
            console.log("05-10 Zone");
            await play_audio("21"); // or concessionary
            await play_audio("23");
            console.log("24-36 Amount");
            play_audio("37");
            break;
        }
      }
      async function play_audio(p, t) {
        let aurl = "https://gopstnm.github.io/wr/lrtm/" + p + lang + ".mp3";
        console.log(p + lang);
        if (audio) {
          audio.pause();
        }
        audio = document.createElement("AUDIO");
        audio.src = aurl
        return new Promise((resolve) => {
          audio.addEventListener('ended', () => {
            resolve();
          });
          audio.play();
        });
      }
    </script>
  </body>
</html>
